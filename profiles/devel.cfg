[buildout]
extends =
	base.cfg
	sources.cfg

parts +=
	nginx.conf
	insider.conf
	api.proxy.conf
	openprocurement.auction.insider-js
	openprocurement.auction.texas-js
	openprocurement.auction.js
	auction_worker_texas.yaml

show-picked-versions = true
update-versions-file = profiles/versions.cfg


[scripts]
eggs +=
	nose
	pytest
	pytest-mock
	pytest-cov
	openprocurement.auction[test]

[versions]
chromedriver = 2.21.1

[auction_worker_defaults.yaml]
AUCTIONS_URL = http://localhost:8090/auctions/{auction_id}
OAUTH_BASE_URL = http://localhost:${ports:3}/api/
OAUTH_REQUEST_TOKEN_URL =
OAUTH_ACCESS_TOKEN_URL = http://localhost:${ports:3}/oauth/token
OAUTH_AUTHORIZE_URL = http://localhost:${ports:3}/oauth/authorize
WORKER_BIND_IP = localhost


[auction_worker_insider.yaml]
AUCTIONS_URL = http://localhost:8090/insider-auctions/{auction_id}
OAUTH_BASE_URL = http://localhost:${ports:3}/api/
OAUTH_REQUEST_TOKEN_URL =
OAUTH_ACCESS_TOKEN_URL = http://localhost:${ports:3}/oauth/token
OAUTH_AUTHORIZE_URL = http://localhost:${ports:3}/oauth/authorize
WORKER_BIND_IP = localhost


[auction_worker_texas.yaml]
<= auction_worker_defaults.yaml
sandbox_mode = ${project:worker_texas_sandbox_mode}
AUCTIONS_URL = http://localhost:8090/texas-auctions/{auction_id}
OAUTH_BASE_URL = http://localhost:${ports:3}/api/
OAUTH_REQUEST_TOKEN_URL =
OAUTH_ACCESS_TOKEN_URL = http://localhost:${ports:3}/oauth/token
OAUTH_AUTHORIZE_URL = http://localhost:${ports:3}/oauth/authorize
WORKER_BIND_IP = localhost


[auctions.ini]
external_couch_url = http://localhost:${ports:1}/auction


[npm]
recipe = zsft.recipe.cmd
package =
install =
	cd ${buildout:directory}/src/${:package} && npm run develop && npm run build

[npm-vue]
recipe = zsft.recipe.cmd
package =
install =
	cd ${buildout:directory}/src/${:package} && npm install && npm run build

[openprocurement.auction.js]
<= npm
package = openprocurement.auction.js


[openprocurement.auction.insider-js]
<= npm
package = openprocurement.auction.insider-js

[openprocurement.auction.texas-js]
<= npm-vue
package = openprocurement.auction.texas-js

[project]
tenders_api_url = http://127.0.0.1:6543/
tenders_api_version = 2.3
tenders_api_token = auction
with_penstock =
with_data_bridge =
with_chronograph = 1
with_nginx = 1
worker_sandbox_mode = 1
plugins = english, dutch, texas
auction_routes=auctions|insider-auctions|texas-auctions
texas = [texas]

[auctions_chronograph.yaml]
use_consul = False


[start_replication_script]
target = http://${project:couchdb_admin}:${project:couchdb_password}@${project:couchdb_host}:${ports:0}/auctions_secured
source = http://${project:couchdb_admin}:${project:couchdb_password}@${project:couchdb_host}:${ports:0}/${project:auctions_couchdb_databese_name}
db_url = http://${project:couchdb_admin}:${project:couchdb_password}@${project:couchdb_host}:${ports:0}/_replicate

[nginx.conf]
<= config-from-template
server_name = "auction"
port = 8090
root = ${buildout:directory}/parts
static_path = static
auctions_path = auctions
html_index = index.html
html_archive = archive.html
html_main = tender.html
plugins = insider


[insider.conf]
<= config-from-template
static_path = insider/static
auctions_url = insider-auctions
html_main = insider/tender.html
name = insider

[api.proxy.conf]
<= config-from-template

[texas]
auction_worker = ${buildout:bin-directory}/auction_texas
auction_worker_config = ${buildout:directory}/etc/auction_worker_texas.yaml
procurement_method_types = ${project:texas}
